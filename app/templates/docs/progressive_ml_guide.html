<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Progressive ML Guide • MarketPulse</title>
  <style>
    :root {
      --bg: #0f172a;         /* slate-900 */
      --panel: #111827;      /* gray-900 */
      --card: #0b1220;       /* custom deep */
      --muted: #94a3b8;      /* slate-400 */
      --text: #e2e8f0;       /* slate-200 */
      --primary: #3b82f6;    /* blue-500 */
      --accent: #10b981;     /* emerald-500 */
      --warn: #f59e0b;       /* amber-500 */
      --danger: #ef4444;     /* red-500 */
      --border: rgba(255,255,255,0.08);
      --border-strong: rgba(255,255,255,0.15);
    }
    * { box-sizing: border-box; }
    body { margin: 0; background: var(--bg); color: var(--text); font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; }
    .container { max-width: 1100px; margin: 0 auto; padding: 24px 16px 40px; }
    .header { background: linear-gradient(135deg, rgba(16,185,129,0.12), rgba(59,130,246,0.12)); border: 1px solid var(--border-strong); padding: 16px; border-radius: 12px; margin-bottom: 16px; }
    h1 { margin: 0 0 6px 0; font-size: 1.8rem; }
    .subtitle { color: var(--muted); font-size: 0.95rem; }
    .grid { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 16px; margin-top: 16px; }
    .card { background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 10px; padding: 14px; }
    h2 { font-size: 1.2rem; color: #ffd700; margin: 0 0 10px 0; }
    h3 { font-size: 1.05rem; color: #93c5fd; margin: 14px 0 8px; }
    p { margin: 8px 0; color: var(--text); }
    ul { margin: 8px 0 8px 18px; }
    li { margin: 4px 0; color: var(--text); }
    .tag { display: inline-block; border: 1px solid var(--border-strong); padding: 2px 8px; border-radius: 999px; font-size: 0.75rem; color: #93c5fd; margin-right: 6px; }
    .pill { display: inline-block; padding: 2px 8px; border-radius: 999px; font-size: 0.75rem; background: rgba(16,185,129,0.12); color: var(--accent); border: 1px solid rgba(16,185,129,0.3); }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; background: #0a0f1c; border: 1px solid var(--border); border-radius: 6px; padding: 1px 6px; font-size: 0.8rem; color: #93c5fd; }
    .hr { height: 1px; background: var(--border); margin: 12px 0; }

    /* Flowchart */
    .flow { background: var(--panel); border: 1px solid var(--border-strong); border-radius: 12px; padding: 14px; }
    .flow-row { display: flex; flex-wrap: wrap; align-items: center; gap: 10px; margin: 8px 0; }
    .node { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 10px 12px; min-width: 180px; }
    .node h4 { margin: 0 0 4px 0; font-size: 0.95rem; color: #ffd700; }
    .node p { margin: 0; font-size: 0.85rem; color: var(--muted); }
    .arrow { color: var(--muted); font-size: 1.2rem; }

    .tip { background: rgba(59,130,246,0.1); border: 1px dashed rgba(59,130,246,0.4); color: #cfe0ff; padding: 10px; border-radius: 8px; font-size: 0.9rem; }

    .kbd-list li { font-size: 0.95rem; }

    .table { width: 100%; border-collapse: collapse; font-size: 0.95rem; }
    .table th, .table td { border: 1px solid var(--border); padding: 8px; }
    .table th { background: rgba(255,255,255,0.06); color: #ffd700; text-align: left; }
    .muted { color: var(--muted); }

    @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Progressive ML Guide</h1>
      <div class="subtitle">End-to-end Auto flow, signals, risk, and best practices</div>
    </div>

    <div class="grid">
      <div class="card">
        <h2>Overview</h2>
        <p>
          Progressive ML trains iteratively on expanding windows, scouts good configurations automatically,
          selects a champion, runs a forward test, and exposes actionable <strong>BUY/SELL/HOLD</strong> signals
          with confidence, expected return caps per horizon, and <strong>SL/TP</strong> context.
        </p>
        <ul>
          <li><span class="tag">Auto‑Plan</span> Clamps dates to available data and ensures prerequisites.</li>
          <li><span class="tag">Auto‑Scout</span> Coarse+Fine candidate search (windows, sequence length, indicator profiles) using short forward accuracy.</li>
          <li><span class="tag">Deep Backtest</span> Trains selected config across iterations with per‑iteration checkpoints.</li>
          <li><span class="tag">Champion</span> Best performing iteration is snapshotted and used for live predictions.</li>
          <li><span class="tag">Forward Test</span> Automatic post‑backtest validation surfaced in the UI.</li>
          <li><span class="tag">Signals</span> BUY/SELL/HOLD + Confidence + %+ (with safety caps) + SL/TP + RR.</li>
        </ul>

        <h2>Flowchart</h2>
        <div class="flow">
          <div class="flow-row">
            <div class="node">
              <h4>Auto‑Plan</h4>
              <p>Ensure data, clamp dates, set iterations</p>
            </div>
            <div class="arrow">→</div>
            <div class="node">
              <h4>Auto‑Scout</h4>
              <p>Coarse+Fine candidates, pick best by short forward</p>
            </div>
            <div class="arrow">→</div>
            <div class="node">
              <h4>Deep Backtest</h4>
              <p>Iterative train/eval; save per-iteration checkpoints</p>
            </div>
          </div>
          <div class="flow-row">
            <div class="node">
              <h4>Champion Snapshot</h4>
              <p>Best iteration locked as champion</p>
            </div>
            <div class="arrow">→</div>
            <div class="node">
              <h4>Forward Test</h4>
              <p>Auto-run; accuracy and metrics surfaced</p>
            </div>
            <div class="arrow">→</div>
            <div class="node">
              <h4>Current Predictions</h4>
              <p>Signal • Conf • %+ with SL/TP per horizon</p>
            </div>
          </div>
        </div>

        <h2>Signals & Risk</h2>
        <h3>What you see</h3>
        <ul>
          <li><strong>Signal:</strong> BUY/SELL/HOLD derived from expected move magnitude and direction probability.</li>
          <li><strong>Confidence:</strong> Blended — model agreement + distance from 50% direction probability.</li>
          <li><strong>%+ (Expected Return):</strong> Shown vs. current price with safety caps per horizon:<br>
            <span class="pill">1D ±10%</span> <span class="pill">7D ±20%</span> <span class="pill">30D ±40%</span>
          </li>
          <li><strong>SL/TP:</strong> Stop‑loss / Take‑profit suggested by ATR (if available) or short‑term volatility.</li>
          <li><strong>RR:</strong> Risk‑Reward ratio (default 1:2) applied to SL/TP distances.</li>
          <li><strong>Capped:</strong> If expected return reaches the safety cap, it’s marked in the tooltip.</li>
        </ul>

        <h3>How SL/TP are computed</h3>
        <ul>
          <li><strong>ATR‑based:</strong> If indicator <span class="kbd">ATR_14</span> exists, use <span class="kbd">ATR_14 / price</span> as baseline risk% (clamped to 0.1%–20%).</li>
          <li><strong>Volatility fallback:</strong> If ATR doesn’t exist, use recent return std (≈14d) × 1.5.</li>
          <li><strong>Direction‑aware:</strong> SL/TP are mirrored depending on predicted direction.</li>
        </ul>

        <div class="tip">
          Tip: SL/TP are guidance — not guarantees. Combine with your position sizing and risk policy.
        </div>

        <h2>Using it from the Dashboard</h2>
        <ol class="kbd-list">
          <li>Open the <span class="kbd">Progressive ML</span> tab.</li>
          <li>Set dates/iterations or use <span class="kbd">Auto (Plan & Run)</span>.</li>
          <li>(Optional) Expand <span class="kbd">Indicator Parameters</span> to override defaults.</li>
          <li>Watch the <span class="kbd">Plan & Preflight</span> card populate, then the <span class="kbd">Champion</span> card.</li>
          <li>Forward test runs automatically; results are displayed.</li>
          <li>Check <span class="kbd">Current predictions</span> for BUY/SELL/HOLD • Conf • %+ and SL/TP per horizon.</li>
        </ol>

        <h2>Troubleshooting</h2>
        <ul>
          <li><strong>All/mostly zeros after iteration 1:</strong> Ensure evaluation loads per‑iteration checkpoints (fixed). If reproduces, verify data window has non‑empty targets.</li>
          <li><strong>Weird start dates:</strong> Date placeholders are clamped to the first trading day for the symbol.</li>
          <li><strong>No SL/TP shown:</strong> Indicators missing? The system falls back to volatility, but if both missing, risk may be omitted.</li>
          <li><strong>Forward test missing:</strong> It’s triggered at job completion; ensure job ran to completion.</li>
        </ul>
      </div>

      <div class="card">
        <h2>Key Concepts</h2>
        <table class="table">
          <tr><th>Term</th><th>Meaning</th></tr>
          <tr><td>Auto‑Plan</td><td>Ensures data and feasible dates; clamps start to first trading day if needed.</td></tr>
          <tr><td>Auto‑Scout</td><td>Explores windows, sequence lengths, and indicator profiles; selects best by short forward accuracy.</td></tr>
          <tr><td>Champion</td><td>Best iteration snapshot; used for current predictions.</td></tr>
          <tr><td>Confidence</td><td>Blended metric: model agreement + distance from neutral direction probability.</td></tr>
          <tr><td>Caps</td><td>Safety limits on displayed expected returns to avoid outliers (1D/7D/30D).</td></tr>
          <tr><td>SL/TP</td><td>Suggested stop-loss/take-profit based on ATR or volatility; direction-aware.</td></tr>
          <tr><td>RR</td><td>Risk-Reward ratio (default 1:2).</td></tr>
          <tr><td>VIX features</td><td>VIX level and daily change used as exogenous inputs.</td></tr>
        </table>

        <h2>Advanced Notes</h2>
        <ul>
          <li>Models: LSTM, CNN‑LSTM, Transformer — ensemble weights derive from validation loss.</li>
          <li>Per‑iteration checkpoints ensure evaluation uses correct model state (prevents zero predictions).</li>
          <li>Sequence length and indicators come from Auto‑Scout choice or user overrides.</li>
        </ul>
        <div class="hr"></div>
        <p class="muted">Version: 2025‑10‑25 • This page is static and safe to bookmark.</p>
      </div>
    </div>
  </div>
</body>
</html>
